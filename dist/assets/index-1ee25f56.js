import{U as u,s as D,j as f,a as l,m as U,t as B,b as F}from"./index-37e6bff1.js";import{U as Oe,g as xe,s as He}from"./index-37e6bff1.js";import{r as $,br as j,e as V,J,ag as r,ak as K,z as b,a5 as x,o as G,I as v,b1 as P,bs as A,ae as q,al as X,bt as Y,bu as Q,P as Z,a7 as p,m as ee}from"./vendor-0ced322d.js";import{W as te,a as ne,e as H,K as ae,b as z}from"./monaco-editor-95e6c5a0.js";import"./basic-630f9520.js";const S=$({fullscreen:!1});j(()=>S.fullscreen,e=>{e?document.body.classList.add("fullscreen"):document.body.classList.remove("fullscreen")});const se=e=>{S.fullscreen=e},le={state:V(S),setFullscreen:se};self.MonacoEnvironment={getWorker(e,m){return m==="json"?new te:new ne}};const oe="_universalEditor_hh5he_5",ie="_formStatus_hh5he_5",re="_fullScreen_hh5he_13",ce="_container_hh5he_25",de="_toolbar_hh5he_28",ue="_logo_hh5he_37",he="_language_hh5he_40",fe="_editor_hh5he_50",ge="_placeholder_hh5he_54",me="_preview_hh5he_63",_e="_markdown_hh5he_72",o={universalEditor:oe,formStatus:ie,fullScreen:re,container:ce,toolbar:de,logo:ue,language:he,editor:fe,placeholder:ge,preview:me,markdown:_e},we=new Map([[u.Markdown,"md"],[u.JSON,"json"]]),be=48,g=24,ve=34,Se=40,ke=e=>{var k;const m=e.placeholder||"请输入内容...",_=e.value||"",E=e.eid||window.location.pathname,c=J(()=>le),w=r.useRef(null),a=r.useRef(),[h,I]=r.useState(!1),[d,R]=r.useState(e.defaultLanguage||u.Markdown),y=()=>{const t=B(Date.now()),n=we.get(d),s=`${E}-${t}.${n}`;F(_,s)},C=()=>{var s,i;const t=h?.5:1,n=(s=a.current)==null?void 0:s.getLayoutInfo();(i=a.current)==null||i.layout({width:c.state.fullscreen?window.innerWidth*t:w.current.clientWidth*t,height:n.height})},M=r.useCallback(()=>{var s;if(!a.current)return!1;const t=a.current.getLayoutInfo();let n=0;if(c.state.fullscreen)n=window.innerHeight-be;else{const i=(e.maxRows??Se)*g,L=(e.minRows??ve)*g,N=a.current.getContentHeight(),W=(s=a.current.getModel())==null?void 0:s.getLineCount();if(N)if(N>i)n=i;else{const O=W*g;O<L?n=L:n=O}}t.height!==n&&a.current.layout({width:t.width,height:n})},[c.state.fullscreen,e.maxRows,e.minRows]),T=()=>{const t=H.create(w.current,{value:_,language:d,theme:"vs-dark",tabSize:2,fontSize:14,lineHeight:g,smoothScrolling:!0,readOnly:Boolean(e.disbaled),minimap:{enabled:!e.disabledMinimap},folding:!0,contextmenu:!1,roundedSelection:!1,scrollBeyondLastLine:!1,wordBasedSuggestions:!0,acceptSuggestionOnEnter:"on",scrollbar:{alwaysConsumeMouseWheel:!1}});return t.addCommand(ae.CtrlCmd|z.KeyS,y),t.addCommand(z.Escape,()=>c.setFullscreen(!1)),t};return K(()=>c.state.fullscreen,()=>M()),r.useEffect(()=>{C()},[C,h]),r.useEffect(()=>{var n;const t=(n=a.current)==null?void 0:n.getModel();t&&d&&H.setModelLanguage(t,d)},[d]),r.useEffect(()=>{var t;(t=a.current)==null||t.updateOptions({readOnly:e.disbaled})},[e.disbaled]),r.useEffect(()=>{var t,n;e.value!==((t=a.current)==null?void 0:t.getValue())&&((n=a.current)==null||n.setValue(e.value||""))},[e.value]),r.useEffect(()=>{a.current=T();const t=a.current.onDidContentSizeChange(M),n=a.current.onDidChangeModelContent(()=>{var i;const s=a.current.getValue();e.disabledCacheDraft||D(E,s),s!==e.value&&((i=e.onChange)==null||i.call(e,s))});return()=>{var s,i;t.dispose(),n.dispose(),(i=(s=a.current)==null?void 0:s.dispose)==null||i.call(s)}},[]),f("div",{style:e.style,className:b(o.universalEditor,e.formStatus&&o.formStatus,c.state.fullscreen&&o.fullScreen),children:[!e.disabledToolbar&&f("div",{className:o.toolbar,children:[f(x,{className:o.left,children:[l(G.Text,{type:"secondary",strong:!0,className:o.logo,children:"UEditor"}),l(v,{size:"small",disabled:e.disbaled,icon:l(P,{}),onClick:y})]}),f(x,{className:o.right,children:[(k=e.renderToolbarExtra)==null?void 0:k.call(e,d),d===u.Markdown&&l(v,{size:"small",disabled:e.disbaled,icon:h?l(A,{}):l(q,{}),onClick:()=>I(!h)}),l(X,{size:"small",value:d,onChange:R,disabled:e.disbaled,className:o.language,options:[{label:"Markdown",value:u.Markdown},{label:"JSON",value:u.JSON}]}),l(v,{size:"small",disabled:e.disbaled,icon:c.state.fullscreen?l(Y,{}):l(Q,{}),onClick:()=>c.setFullscreen(!c.state.fullscreen)})]})]}),l(Z,{spinning:Boolean(e.loading),indicator:l(p,{style:{fontSize:24},spin:!0}),children:f("div",{className:o.container,children:[l("div",{id:"container",ref:w,className:b(o.editor,!e.value&&o.placeholder),placeholder:m}),l(ee,{in:h,timeout:200,unmountOnExit:!0,classNames:"fade-fast",children:l("div",{className:b(o.preview),children:l("div",{className:o.markdown,dangerouslySetInnerHTML:{__html:U(_)}})})})]})})]})};export{Oe as UEditorLanguage,ke as UniversalEditor,xe as getUEditorCache,He as setUEditorCache};
