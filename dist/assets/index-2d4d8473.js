import{U as u,s as D,j as g,a as l,m as U,t as B,b as F}from"./index-fe60061f.js";import{U as Oe,g as xe,s as He}from"./index-fe60061f.js";import{r as $,bv as j,e as V,J,ag as r,ao as K,ai as b,a5 as x,o as G,I as v,b5 as P,bw as A,ae as q,ap as X,bx as Y,by as Q,P as Z,a7 as p,m as ee}from"./vendor-606cf0a6.js";import{W as te,a as ne,e as H,K as ae,b as I}from"./monaco-editor-95e6c5a0.js";import"./basic-c9b77c71.js";const S=$({fullscreen:!1});j(()=>S.fullscreen,e=>{e?document.body.classList.add("fullscreen"):document.body.classList.remove("fullscreen")});const se=e=>{S.fullscreen=e},le={state:V(S),setFullscreen:se};self.MonacoEnvironment={getWorker(e,h){return h==="json"?new te:new ne}};const oe="_universalEditor_1eh0e_5",ie="_formStatus_1eh0e_5",re="_fullScreen_1eh0e_13",ce="_container_1eh0e_25",de="_toolbar_1eh0e_28",ue="_logo_1eh0e_37",fe="_language_1eh0e_40",ge="_editor_1eh0e_50",me="_placeholder_1eh0e_54",he="_preview_1eh0e_63",_e="_markdown_1eh0e_72",o={universalEditor:oe,formStatus:ie,fullScreen:re,container:ce,toolbar:de,logo:ue,language:fe,editor:ge,placeholder:me,preview:he,markdown:_e},we=new Map([[u.Markdown,"md"],[u.JSON,"json"]]),be=48,m=24,ve=34,Se=40,ke=e=>{var k;const h=e.placeholder||"请输入内容...",_=e.value||"",E=e.eid||window.location.pathname,c=J(()=>le),w=r.useRef(null),a=r.useRef(),[f,R]=r.useState(!1),[d,z]=r.useState(e.defaultLanguage||u.Markdown),y=()=>{const t=B(Date.now()),n=we.get(d),s=`${E}-${t}.${n}`;F(_,s)},C=()=>{var s,i;const t=f?.5:1,n=(s=a.current)==null?void 0:s.getLayoutInfo();(i=a.current)==null||i.layout({width:c.state.fullscreen?window.innerWidth*t:w.current.clientWidth*t,height:n.height})},M=r.useCallback(()=>{var s;if(!a.current)return!1;const t=a.current.getLayoutInfo();let n=0;if(c.state.fullscreen)n=window.innerHeight-be;else{const i=(e.maxRows??Se)*m,L=(e.minRows??ve)*m,N=a.current.getContentHeight(),W=(s=a.current.getModel())==null?void 0:s.getLineCount();if(N)if(N>i)n=i;else{const O=W*m;O<L?n=L:n=O}}t.height!==n&&a.current.layout({width:t.width,height:n})},[c.state.fullscreen,e.maxRows,e.minRows]),T=()=>{const t=H.create(w.current,{value:_,language:d,theme:"vs-dark",tabSize:2,fontSize:14,lineHeight:m,smoothScrolling:!0,readOnly:Boolean(e.disbaled),minimap:{enabled:!e.disabledMinimap},folding:!0,contextmenu:!1,roundedSelection:!1,scrollBeyondLastLine:!1,wordBasedSuggestions:!0,acceptSuggestionOnEnter:"on",scrollbar:{alwaysConsumeMouseWheel:!1}});return t.addCommand(ae.CtrlCmd|I.KeyS,y),t.addCommand(I.Escape,()=>c.setFullscreen(!1)),t};return K(()=>c.state.fullscreen,()=>M()),r.useEffect(()=>{C()},[C,f]),r.useEffect(()=>{var n;const t=(n=a.current)==null?void 0:n.getModel();t&&d&&H.setModelLanguage(t,d)},[d]),r.useEffect(()=>{var t;(t=a.current)==null||t.updateOptions({readOnly:e.disbaled})},[e.disbaled]),r.useEffect(()=>{var t,n;e.value!==((t=a.current)==null?void 0:t.getValue())&&((n=a.current)==null||n.setValue(e.value||""))},[e.value]),r.useEffect(()=>{a.current=T();const t=a.current.onDidContentSizeChange(M),n=a.current.onDidChangeModelContent(()=>{var i;const s=a.current.getValue();e.disabledCacheDraft||D(E,s),s!==e.value&&((i=e.onChange)==null||i.call(e,s))});return()=>{var s,i;t.dispose(),n.dispose(),(i=(s=a.current)==null?void 0:s.dispose)==null||i.call(s)}},[]),g("div",{style:e.style,className:b(o.universalEditor,e.formStatus&&o.formStatus,c.state.fullscreen&&o.fullScreen),children:[!e.disabledToolbar&&g("div",{className:o.toolbar,children:[g(x,{className:o.left,children:[l(G.Text,{type:"secondary",strong:!0,className:o.logo,children:"UEditor"}),l(v,{size:"small",disabled:e.disbaled,icon:l(P,{}),onClick:y})]}),g(x,{className:o.right,children:[(k=e.renderToolbarExtra)==null?void 0:k.call(e,d),d===u.Markdown&&l(v,{size:"small",disabled:e.disbaled,icon:f?l(A,{}):l(q,{}),onClick:()=>R(!f)}),l(X,{size:"small",value:d,onChange:z,disabled:e.disbaled,className:o.language,options:[{label:"Markdown",value:u.Markdown},{label:"JSON",value:u.JSON}]}),l(v,{size:"small",disabled:e.disbaled,icon:c.state.fullscreen?l(Y,{}):l(Q,{}),onClick:()=>c.setFullscreen(!c.state.fullscreen)})]})]}),l(Z,{spinning:Boolean(e.loading),indicator:l(p,{style:{fontSize:24},spin:!0}),children:g("div",{className:o.container,children:[l("div",{id:"container",ref:w,className:b(o.editor,!e.value&&o.placeholder),placeholder:h}),l(ee,{in:f,timeout:200,unmountOnExit:!0,classNames:"fade-fast",children:l("div",{className:b(o.preview),children:l("div",{className:o.markdown,dangerouslySetInnerHTML:{__html:U(_)}})})})]})})]})};export{Oe as UEditorLanguage,ke as UniversalEditor,xe as getUEditorCache,He as setUEditorCache};
